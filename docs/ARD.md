
**Cursor 2026-02-08 12:30**

Я реализовал план рефакторинга и привел проект в соответствие с принципами Чистой Архитектуры.

### Выполненные изменения:

1.  **Создана структура каталогов (`src/`)**:
    *   `src/domain`: Содержит бизнес-сущности и интерфейсы.
    *   `src/application`: Содержит Use Cases (сценарии использования).
    *   `src/infrastructure`: Содержит реализацию адаптеров (Weaviate, Tokenizer).
    *   `src/presentation`: Содержит точки входа (MCP серверы).
    *   `src/config`: Содержит настройки и DI-контейнер.

2.  **Слой Домена (`src/domain`)**:
    *   `entities.py`: Определены Pydantic модели `ProjectEntity` и `ServiceEntity`.
    *   `interfaces.py`: Определен протокол `IKnowledgeBase`, описывающий контракт для работы с базой знаний.

3.  **Слой Инфраструктуры (`src/infrastructure`)**:
    *   `db/weaviate_adapter.py`: Реализован класс `WeaviateAdapter`, который имплементирует `IKnowledgeBase`. Вся логика работы с Weaviate и трансформерами инкапсулирована здесь.
    *   `nlp/tokenizer.py`: Вынесена логика лемматизации текста.

4.  **Слой Приложения (`src/application`)**:
    *   `use_cases.py`: Реализован `SearchUseCase`, который оркестрирует поиск, используя абстракцию `IKnowledgeBase`.

5.  **Конфигурация (`src/config`)**:
    *   `settings.py`: Управление переменными окружения через Pydantic Settings.
    *   `container.py`: Простой DI-контейнер для связывания зависимостей (`WeaviateAdapter` -> `SearchUseCase`).

6.  **Слой Представления (`src/presentation`)**:
    *   `mcp_server.py`: Обновленный MCP сервер (stdio), использующий новую архитектуру.
    *   `mcp_sse_server.py`: Обновленный SSE сервер, использующий новую архитектуру.

Теперь проект имеет четкое разделение ответственности, тестируемую структуру и соответствует требованиям Enterprise-разработки. Старые файлы в корне (`mcp_server.py`, `shared/` и т.д.) можно удалить после проверки работоспособности новой версии.